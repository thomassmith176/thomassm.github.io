<!DOCTYPE html>
<html>
  <head>
    <title>Drawing tools</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
/*      .gm-style-iw{
          height: 100% !important;
          overflow: hidden !important;
      }*/
   
</style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAKQ6z25VTkDdtA7MY3hKDOzR0tVg6gMfk&v=3.exp&sensor=false&libraries=drawing,geometry"></script>
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script>
        var map;
        var currentOverlay;
        var mouseOverListenerHandle = null;//this is to hide radius
        var infoWindow;

function initialize() {
  var mapOptions = {
    center: new google.maps.LatLng(-34.397, 150.644),
    zoom: 8
  };
  
  // starting location of drawn overlays for distance/area calculations
  var firstLatLng;
  // the current completed overlay

  
  var overlayTypes = [
 //   google.maps.drawing.OverlayType.CIRCLE
//	,google.maps.drawing.OverlayType.RECTANGLE
    google.maps.drawing.OverlayType.POLYGON
  ];
  
   map = new google.maps.Map(document.getElementById('map-canvas'),
    mapOptions);

  // cycle through the overlayTypes
  function nextOverlayType() {
    var next = overlayTypes.shift();
	overlayTypes.push(next);
	return next;
  }

  // deactivate the Drawing manager and listen for clicks on the new overlay
  function overlayCompleteListener (event) {
    console.log('overlayCompleteListener');
    drawingManager.setDrawingMode(null);
	currentOverlay = event.overlay;
	currentOverlay.addListener('click', overlayClickListener);
	currentOverlay.addListener('radius_changed', showRadius);
	currentOverlay.addListener('center_changed', showRadius);
	showRadius();


  };


  function showRadius(){
      console.log('showRadius');
      if(infoWindow != null){
          infoWindow.setMap(null);
      }
      $("#map-canvas").unbind("mousemove");
      $("#distanceSign SPAN.radiusValue").text((currentOverlay.getRadius()/1000.0).toFixed(3));
      var content = $("#distanceSign").html();
      infoWindow = new google.maps.InfoWindow({
          content:content,
          position:currentOverlay.getCenter()
      });
      infoWindow.open(map);
      $("#map-canvas").mousemove(function (e) {
          infoWindow.setMap(null);
      });

  }
  
  // remove the overlay
  function overlayClickListener (event) {
    console.log('overlayClickListener');
    event.stop();
    if (typeof event.path === 'undefined') { // ignore clicks on polygon paths
	  drawingManager.setDrawingMode(nextOverlayType());
	  currentOverlay.setMap(null);
	  google.maps.event.clearInstanceListeners(currentOverlay);
	  currentOverlay = null;
	}
  };

  var drawingManager = new google.maps.drawing.DrawingManager({
    drawingMode: nextOverlayType(),
    drawingControl: true,
    markerOptions: {
      icon: 'images/beachflag.png'
    },
    circleOptions: {
      editable: true
    },
	polygonOptions: {
	  editable: true
	},
	polylineOptions: {
	  editable: true
	},
	rectangleOptions: {
	  editable: true
	}
  });
  drawingManager.setMap(map);
  drawingManager.addListener('overlaycomplete', overlayCompleteListener);

}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
    <div id="distanceSign" style="display:none;">
        <div style="width:120px; height:30px">
            <span>Radius :</span><span class="radiusValue"></span><span>km</span>
        </div>
    </div>
  </body>
</html>
